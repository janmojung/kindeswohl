<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App: Risikofaktoren f√ºr Kindesmisshandlungen</title>
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <style>
        /* --- CSS STYLES --- */
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 10px;
            min-height: 100vh;
        }

        h1 { color: #2c3e50; margin-bottom: 20px; text-align: center; }

        /* Navigation */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        .nav-btn {
            padding: 10px 20px; background: #e0e0e0; border: none; border-radius: 20px;
            cursor: pointer; font-weight: bold; color: #555; transition: 0.3s;
        }
        .nav-btn.active { background: #3498db; color: white; }

        /* Layout */
        .main-container {
            display: flex; gap: 15px; width: 100%; max-width: 1400px; height: 75vh;
        }
        
        .view-section { width: 100%; height: 100%; overflow-y: auto; display: block; padding-right: 5px; }
        
        /* WICHTIG: Hidden Klasse mit !important */
        .hidden { display: none !important; }

        /* Sidebar Pool */
        .sidebar {
            flex: 0 0 280px; background: white; padding: 10px; border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow-y: auto; border: 2px solid #bdc3c7;
            display: flex; flex-direction: column; gap: 5px;
        }
        
        /* Draggable Items */
        .item {
            background: #f7f9fa; border: 1px solid #bdc3c7; border-left: 4px solid #3498db;
            padding: 8px; border-radius: 4px; cursor: grab; font-size: 0.85rem; margin-bottom: 5px;
            page-break-inside: avoid; touch-action: none;
            transition: background-color 0.2s;
        }
        .item:active { cursor: grabbing; }

        /* Farben f√ºr L√∂sung */
        .color-mikro { background-color: #fce4ec !important; border-left-color: #f06292 !important; }
        .color-meso { background-color: #ffecb3 !important; border-left-color: #ffb300 !important; }
        .color-exo { background-color: #e0f7fa !important; border-left-color: #00bcd4 !important; }
        .color-makro { background-color: #e8f5e9 !important; border-left-color: #8bc34a !important; }
        
        /* Empirische L√∂sung (Dunkelgr√ºn) */
        .item.empirical-high { 
            background: #c8e6c9 !important; 
            border-color: #2e7d32 !important; 
            border-left-color: #2e7d32 !important;
            font-weight: bold; 
            box-shadow: 0 0 5px rgba(46, 125, 50, 0.5);
        }

        /* Tab 1: Grid */
        #view-classification { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .column-drop-zone {
            background: white; border-radius: 8px; padding: 10px; border: 2px dashed #ccc;
            display: flex; flex-direction: column; gap: 5px; overflow-y: auto;
        }
        .column-title { text-align: center; font-weight: bold; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 2px solid #eee; }

        /* Tab 2: Ranking */
        .ranking-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; page-break-inside: avoid; }
        .rank-num { font-weight: bold; width: 30px; text-align: right; }
        .ranking-slot {
            flex-grow: 1; min-height: 45px; border: 2px dashed #bdc3c7; background: #fafafa;
            border-radius: 6px; display: flex; align-items: center; padding-left: 5px;
        }

        /* Tab 3: Chains */
        .chain-wrapper {
            background: white; padding: 10px; margin-bottom: 15px; border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            page-break-inside: avoid;
        }
        .chain-slots { display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 10px; flex-wrap: wrap;}
        .slot {
            width: 180px; height: 80px; border: 2px dashed #ccc; background: #fafafa;
            display: flex; justify-content: center; align-items: center; text-align: center;
            flex-direction: column; font-size: 0.8rem; border-radius: 6px;
        }

        /* Controls */
        .controls { margin-top: 10px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; align-items: center; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white;}
        .btn-reset { background: #7f8c8d; }
        .btn-solve { background: #2980b9; }
        .btn-pdf { background: #c0392b; margin-left: 10px; }

        /* --- PDF PRINT STYLES --- */
        @media print {
            body { background: white; height: auto; overflow: visible; }
            .sidebar, .nav-tabs, .controls, .btn-pdf, header h1 { display: none !important; }
            .main-container { height: auto; display: block; }
            .view-section { overflow: visible; height: auto; }
            .hidden { display: none !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            body::before {
                content: "Ergebnisse";
                font-size: 20pt; font-weight: bold; display: block; margin-bottom: 20px; text-align: center;
            }
        }

        @media (max-width: 800px) {
            .main-container { flex-direction: column; height: auto; }
            .sidebar { max-height: 200px; flex: none; }
            #view-classification { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<header>
    <h1>App: Risikofaktoren f√ºr Kindesmisshandlungen</h1>
</header>

<div class="nav-tabs">
    <button class="nav-btn active" id="tab-btn-classification" onclick="switchTab('classification')">1. Klassifizierung</button>
    <button class="nav-btn" id="tab-btn-ranking" onclick="switchTab('ranking')">2. Empirisch besonders relevante Risikofaktoren</button>
    <button class="nav-btn" id="tab-btn-chain" onclick="switchTab('chain')">3. Wirkungsketten</button>
</div>

<div class="main-container">
    <div class="sidebar" id="item-pool">
        <div style="text-align:center; font-weight:bold; padding-bottom:5px; border-bottom:1px solid #eee;">Pool</div>
    </div>

    <div id="view-classification" class="view-section" style="grid-template-rows: min-content auto;">
        <p style="text-align:center; grid-column: 1 / -1; margin-bottom: 10px; color:#666; font-size:0.9rem;">Ordnen Sie die links aufgelisteten Risikofaktoren den Systemen des √∂kosystemischen Modells zu.</p>        
        <div class="column-drop-zone" style="border-color:#f06292"><div class="column-title" style="color:#f06292">Mikrosystem</div></div>
        <div class="column-drop-zone" style="border-color:#ffb300"><div class="column-title" style="color:#ffb300">Mesosystem</div></div>
        <div class="column-drop-zone" style="border-color:#00bcd4"><div class="column-title" style="color:#00bcd4">Exosystem</div></div>
        <div class="column-drop-zone" style="border-color:#8bc34a"><div class="column-title" style="color:#8bc34a">Makrosystem</div></div>
    </div>

    <div id="view-ranking" class="view-section hidden">
        <p style="text-align:center; color:#666; font-size:0.9rem;">W√§hlen Sie acht Risikofaktoren aus, die Ihrer Meinung nach besonders relevant in der Enstehung von Kindesmisshandlungen sind. Begr√ºnden Sie Ihre Auswahl!</p>
        <div id="ranking-container" style="max-width:700px; margin:0 auto;"></div>
    </div>

    <div id="view-chain" class="view-section hidden">
        <p style="text-align:center; color:#666; margin-bottom:20px;">Bilden Sie 5 plausible Pfade: Risikofaktor &rarr; Mechanismus &rarr; Kindesmisshandlung</p>
        <div id="chains-container"></div>
    </div>
</div>

<div class="controls">
    <button class="btn-reset" onclick="init()">Reset</button>
    <button class="btn-pdf" onclick="window.print()">üìÑ Als PDF speichern</button>

    <span id="ctrl-classification">
        <button class="btn-solve" onclick="solveColors()">L√∂sung: Klassifikation</button>
    </span>

    <span id="ctrl-ranking" class="hidden">
        <button class="btn-solve" style="background:#4caf50" onclick="solveEmpirical()">L√∂sung: Bedeutendste Risikofaktoren</button>
    </span>

    <span id="ctrl-chain" class="hidden"></span>
</div>

<script>
    // --- DATEN ---
    const rawData = [
        // MIKRO
        { id: 4, text: "Elterliche Stressbelastung", level: "mikro", role: "proximal", high: true },
        { id: 5, text: "Psychopathologie Eltern", level: "mikro", role: "proximal", high: true },
        { id: 8, text: "Misshandlungserfahrung Eltern", level: "mikro", role: "proximal", high: true },
        { id: 15, text: "Substanzmissbrauch Eltern", level: "mikro", role: "proximal", high: true },
        { id: 23, text: "Famili√§re Konflikte/ Partnerschaftsgewalt", level: "mikro", role: "proximal", high: true },
        { id: 7, text: "Geringes Alter Eltern", level: "mikro", role: "proximal", high: true },
        { id: 301, text: "Geringes Alter Kind", level: "mikro", role: "proximal", high: false },
        { id: 303, text: "Verhaltensprobleme/-auff√§lligkeiten Kind", level: "mikro", role: "proximal", high: true },
        { id: 304, text: "M√§nnliches Geschlecht Kind", level: "mikro", role: "proximal", high: false },

        
        // MESO (Erweitert)
        { id: 10, text: "Magelnde soz. Unterst√ºtzung der Familie", level: "meso", role: "proximal", high: false },
        { id: 200, text: "Schlechte Kooperation von Elternhaus & Schule/Kita", level: "meso", role: "proximal", high: false },
        { id: 201, text: "Konflikte zwischen getrennt lebenden Elternteilen", level: "meso", role: "proximal", high: false },
        { id: 202, text: "Mangelnde Anbindung an Hilfesysteme (√Ñrzte, Amt)", level: "meso", role: "proximal", high: false },

        // EXO (Erweitert)
        { id: 6, text: "Arbeitslosigkeit", level: "exo", role: "distal", high: false },
        { id: 11, text: "Geringer sozio√∂konomischer Status der Eltern", level: "exo", role: "distal", high: true },
        { id: 300, text: "Mangelnde Angebote der Kinder- und Jugendhilfe", level: "exo", role: "distal", high: false },
        { id: 30, text: "Stress am Arbeitsplatz", level: "exo", role: "distal", high: false },
        { id: 50, text: "Kriminalit√§tsbelastete Nachbarschaft", level: "exo", role: "distal", high: false },

        // MAKRO (Erweitert)
        { id: 27, text: "K√∂rperstrafe als Norm in Gesellschaft", level: "makro", "role": "distal", "highImpact": false },
        { id: 29, text: "L√ºckenhafte Gesetzgebung", level: "makro", "role": "distal", "highImpact": false },
        { id: 400, text: "Armut/Ungleichheit in Gesellschaft", level: "makro", "role": "distal", "highImpact": false },
        { id: 60, text: "Gesellschaftliche Toleranz von Gewalt", level: "makro", "role": "distal", "highImpact": false },
        { id: 61, text: "Fehlende soziale Sicherungssysteme", level: "makro", "role": "distal", "highImpact": false },
        { id: 62, text: "Kulturelles Bild: 'Kind als Eigentum'", level: "makro", "role": "distal", "highImpact": false }
    ];

    let currentTab = 'classification';
    let draggedItem = null;

    // --- INIT ---
    document.addEventListener('DOMContentLoaded', function() {
        init();
        switchTab('classification');
    });

    window.init = function() {
        const pool = document.getElementById('item-pool');
        if(!pool) return; 

        pool.innerHTML = '<div style="text-align:center; font-weight:bold; padding-bottom:5px; border-bottom:1px solid #eee;">M√∂gliche Risikofaktoren</div>';
        
        document.querySelectorAll('.item').forEach(e => e.remove());
        
        // Ranking Slots (Top 8)
        const rankCont = document.getElementById('ranking-container');
        if(rankCont) {
            rankCont.innerHTML = '';
            for(let i=1; i<=8; i++){
                rankCont.innerHTML += `
                    <div class="ranking-row">
                        <div class="rank-num">${i}.</div>
                        <div class="ranking-slot drop-zone" data-type="rank"></div>
                    </div>`;
            }
        }

        // Chains Slots
        const chainCont = document.getElementById('chains-container');
        if(chainCont) {
            chainCont.innerHTML = '';
            for(let i=1; i<=5; i++){
                chainCont.innerHTML += `
                    <div class="chain-wrapper">
                        <strong>Kette ${i}</strong>
                        <div class="chain-slots">
                            <div class="slot drop-zone" data-type="distal" style="border-color:#3498db">Risikofaktor</div>
                            <span>‚ûî</span>
                            <div class="slot drop-zone" data-type="proximal" style="border-color:#e67e22">Mechanismus</div>
                            <span>‚ûî</span>
                            <div class="slot" style="background:#ffebee; border-color:#c0392b; color:#c0392b"><b>Kindesmisshandlung</b></div>
                        </div>
                    </div>`;
            }
        }

        // Items erstellen
        const shuffledData = [...rawData].sort(() => Math.random() - 0.5);
        shuffledData.forEach(data => {
            const el = document.createElement('div');
            el.className = 'item';
            el.draggable = true;
            el.innerText = data.text;
            el.dataset.id = data.id;
            el.dataset.level = data.level;
            el.dataset.role = data.role;
            // highImpact vs high Fix: Die JSON keys waren gemischt
            el.dataset.high = (data.high === true || data.highImpact === true) ? "true" : "false"; 
            
            el.addEventListener('dragstart', function(e) {
                draggedItem = this;
                setTimeout(() => this.style.display = "none", 0);
            });
            el.addEventListener('dragend', function(e) {
                setTimeout(() => this.style.display = "block", 0);
                draggedItem = null;
            });
            pool.appendChild(el);
        });

        setupDropZones();
    };

    // Globale Tab Navigation
    window.switchTab = function(tabName) {
        currentTab = tabName;
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        const btn = document.getElementById('tab-btn-' + tabName);
        if(btn) btn.classList.add('active');

        document.querySelectorAll('.view-section').forEach(v => v.classList.add('hidden'));
        const view = document.getElementById('view-' + tabName);
        if(view) view.classList.remove('hidden');
        
        // Grid Fix
        if(tabName === 'classification' && view) {
            view.style.display = 'grid';
        } else if (view) {
            view.style.display = 'block';
        }

        // Controls
        const allControls = ['ctrl-classification', 'ctrl-ranking', 'ctrl-chain'];
        allControls.forEach(c => {
            const el = document.getElementById(c);
            if(el) el.classList.add('hidden');
        });
        
        const activeCtrl = document.getElementById('ctrl-' + tabName);
        if(activeCtrl) activeCtrl.classList.remove('hidden');
    };

    // --- HELPER ---
    function setupDropZones() {
        const zones = document.querySelectorAll('#item-pool, .column-drop-zone, .ranking-slot, .slot.drop-zone');
        zones.forEach(zone => {
            zone.addEventListener('dragover', (e) => e.preventDefault());
            zone.addEventListener('drop', handleDrop);
        });
    }

    function handleDrop(e) {
        e.preventDefault();
        let target = e.target.closest('.drop-zone, #item-pool, .column-drop-zone');
        
        if (target && draggedItem) {
            if ((target.classList.contains('ranking-slot') || target.classList.contains('slot')) && target.children.length > 0) {
                document.getElementById('item-pool').appendChild(target.children[0]);
            }
            target.appendChild(draggedItem);
        }
    }

    // --- L√ñSUNGEN MIT PASSWORT ---
    
    // TAB 1: Farben (Passwort: bronfenbrenner)
    window.solveColors = function() {
        const password = prompt("Passwort f√ºr Klassifizierung:", "");
        if(password !== "bronfenbrenner") {
            alert("Falsches Passwort!");
            return;
        }

        // 1. Empirie entfernen
        document.querySelectorAll('.item').forEach(item => {
            item.classList.remove('empirical-high');
        });
        // 2. Farben setzen
        document.querySelectorAll('.item').forEach(item => {
            const level = item.dataset.level;
            item.classList.add('color-' + level);
        });
        alert("L√∂sung angezeigt: Ebenen eingef√§rbt.");
    };

    // TAB 2: Empirie (Passwort: rangreihe)
    window.solveEmpirical = function() {
        const password = prompt("Passwort f√ºr Rangreihe:", "");
        if(password !== "rangreihe") {
            alert("Falsches Passwort!");
            return;
        }

        // 1. Farben entfernen
        document.querySelectorAll('.item').forEach(item => {
            item.classList.remove('color-mikro', 'color-meso', 'color-exo', 'color-makro');
        });
        // 2. Empirie setzen
        document.querySelectorAll('.item').forEach(item => {
            if (item.dataset.high === "true") {
                item.classList.add('empirical-high');
            }
        });
        alert("L√∂sung angezeigt: Wichtige Faktoren gr√ºn markiert.");
    };

</script>
</body>
</html>
